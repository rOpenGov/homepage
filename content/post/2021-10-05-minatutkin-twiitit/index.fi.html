---
title: "#minätutkin-twiittien aiheet"
date: "2021-10-05"
author: "Tuija Sonkkila"
slug: "mina-tutkin"
categories:
  - R
  - asiasanoitus
  - ontologiat
  - visualisointi
tags:
  - twitter
  - finto
output:
  blogdown::html_page:
    highlight: tango
---

<script src="{{< blogdown/postref >}}index.fi_files/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<p>Kuukausi sitten, syyskuun alussa 2021, Twitterin <em>#minätutkin</em> oli suosittu. Itä-Suomen yliopiston akateeminen rehtori Tapio Määttä <a href="https://twitter.com/tapiomaatta/status/1434449463268057092">sysäsi ajatuksen liikkeelle</a>, ja pian mukaan liitettiin sopiva aihetunniste. Tutkijat innostuivat tiivistämään työnsä twiitin merkkimäärään, ja suuri yleisö innostui yhtä lailla lukemastaan. Vaikka Suomesta löytyy ajantasaisia sivustoja kotimaisesta tutkimuksesta, uusimpana <a href="https://www.tiedejatutkimus.fi/fi/">tutkimustietovaranto</a>, niiden varsinainen fokus ei ole tehdä tiedettä helposti lähestyttäväksi. Toki ne saattavat onnistua siinäkin, mutta vain välillisesti.</p>
<p>Mistä sitten twiitattiin? Mitä olivat ne tieteenalat, joiden tutkijat ehtivät tai kiinnostuivat twiittaamaan? Kaikki eivät tietenkään edes kuulleet asiasta.</p>
<p>Päätin tehdä pienimuotoisen testin siitä, miten Kansalliskirjaston <a href="https://www.kiwi.fi/display/Finto/Finto+AI%3An+rajapintapalvelu">Finto AI -rajapintapalvelu</a> palvelisi twiittien automaattisessa asiasanoituksessa. Heti alkuun pitää painottaa siitä, että Finto AI/Annif on toistaiseksi pelkkä suosittelija; ihmisen on tarkoitus tehdä lopulliset asiasanavalinnat. Näin toimitaan mm. Jyväskylän yliopiston JYX-julkaisuarkistossa, jossa palvelua käytetään opinnäytetöiden kuvailun apuna:</p>
<blockquote>
<p>Opinnäytetyönsä järjestelmään jättävä opiskelija saa nähtäväkseen Annifin ehdottamat asiasanat, joita hän voi halutessaan muokata. Lopulliset asiasanat hyväksyy kirjastovirkailija tarkistuksen jälkeen. Myös Kirjavälitys Oy käyttää rajapintapalvelua tuottaessaan ennakkotietoja tulevista kirjajulkaisuista. Vastaavanlaista käyttöä pilotoidaan tällä hetkellä mm. Vaasan yliopiston Osuva-julkaisuarkistossa.</p>
</blockquote>
<p>Tässä harjoituksessa annan kuitenkin mennä täysautomaatilla, kädet poissa ratilta.</p>
<p>Alla olevat koodit ovat <a href="https://github.com/tts/minatutkintweets">GitHub-repossa</a>.</p>
<div id="twiittien-haku-ja-siivous" class="section level3">
<h3>Twiittien haku ja siivous</h3>
<p>Kun haluaa kerätä twiittejä ilman erityisjärjestelyjä, on toimittava ripeästi. Vaikka #minätutkin-häntää on näkynyt aina näihin päiviin asti, hain tässä käsitellyt twiitit jo sunnuntaina 12.9. alkuiltapäivästä enkä sen jälkeen enää uudistanut hakua. Vilkkaimmat päivät olivat tiistai-torstai 7-9.9.</p>
<p>Harto Pöngän <a href="https://twitter.com/hponka/status/1436240568045158402">10.9 keräämien tilastojen mukaan</a> 5000 twiittiä vaikutti sopivalta ylärajalta. Ei uudelleentwiittauksia.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtweet)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="st">&quot;#minätutkin&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(q, <span class="at">n =</span> <span class="dv">5000</span>, <span class="at">include_rts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Siivous on enimmäkseen käsityötä. Aivan aluksi poistin selkeimpiä trollauksia, lukijoiden kiittäviä postauksia ja muita tässä yhteydessä epärelevantteja. Myöhemmin kävin vielä twiitit kertaalleen läpi ja filtteröin pois ne, jotka eivät olleet tutkijoilta itseltään vaan suurelta yleisöltä, tutkimusorganisaatiolta tai rahoittajalta. En edes pyrkinyt täydelliseen siivoukseen, ja lisäksi twiiteissä oli rajatapauksia.</p>
<p>Osa tutkijoista postitti useita #minätutkin-twiittejä. Joiltakin oli unohtunut ensimmäisestä aihetunniste - jolloin se ei siis tarttunut haaviini - jotkut halusivat täydentää, eräät taas jatkoivat aiheen parissa muulla tavoin, innostaen kolleegoita tulemaan mukaan yms. Yhdistin ne kaikki.</p>
<p>Tämän osuuden koodi on tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/gettweets.R">gettweets.R</a></p>
</div>
<div id="asiasanoitus" class="section level3">
<h3>Asiasanoitus</h3>
<p>Finto AI -rajapintapalvelulle lähetetään asiasanoitettava teksti HTTP POST -kutsussa. Palautettavien asiasanojen lukumäärää voi säätää (limit), samoin niiden osumistarkkuuden kynnysarvoa (threshold). URL:ssa on oltava tieto <em>projektista</em> eli siitä, minkä kielisestä tekstistä on kyse. Palvelun ohjeistus on interaktiivinen <a href="https://ai.finto.fi/v1/ui/">Swagger-hiekkalaatikko</a>.</p>
<p>En tiedä, kuinka luotettava Twitterin palauttama <code>lang</code>-arvo on, mutta joka tapauksessa käytin sitä. Satunnaisotannalla se näytti olevan oikeassa. Kieli ei kuitenkaan ole yksiselitteinen asia, sillä osa twiittaajista käyttää kahta kieltä samanaikaisesti.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>make_body <span class="ot">&lt;-</span> <span class="cf">function</span>(tw){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> tw,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">limit =</span> <span class="dv">3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> body</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(body)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">RETRY</span>(<span class="at">verb =</span> <span class="st">&quot;POST&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://ai.finto.fi/v1/projects/&quot;</span>, project, <span class="st">&quot;/suggest&quot;</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">body =</span> <span class="fu">make_body</span>(tweet),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">user_agent</span>(<span class="st">&quot;https://github.com/tts/minatutkintweets&quot;</span>))</span></code></pre></div>
<p>Asiasanoitus tarkoittaa toistuvaa rajapinnan kutsua. Finto AI:n käyttöohjeissa toivotaan, ettei rajapintaa kuormitettaisi samanaikaisilla kutsuilla, mikä on ymmärrettävää. Rajapinta on toistaiseksi täysin avoin, mitään rekisteröintiä ei ole. Otin yhteyttä Finton asiakaspalveluosoitteeseen, kun aloin epäillä koodini aiheuttavan ongelmia. Yritin näet lisätä kutsujen väliin <code>Sys.sleep()</code> -kutsun, mutta en onnistunut löytämään sille toimivaa koloa; kutsut palauttivat tyhjää. Finton vastaus oli rauhoittava: he eivät olleet huomanneet palvelussa mitään epänormaalista poikkeavaa liikennettä.</p>
<p>Kutsuihin ja tulosten parsimiseen lainasin ison osan vastaavasta koodista <a href="https://github.com/ropensci/roadoi">roadoi’lta</a>, joka on yksi <a href="https://ropensci.org/">rOpenSci-yhteisön</a> piirissä ylläpidettävistä lukuisista kirjastoista. Sain olla mukana <code>roadoi</code>’n <a href="https://github.com/ropensci/software-review/issues/115">hyväksyntäprosessissa</a>. Siinä keskityin toiminnallisuuteen ja opasteisiin, nyt hyödynsin ensimmäistä kerran kirjaston koodia. Kysyin Najko Jahnilta, <a href="https://github.com/ropensci/roadoi/issues/33">mihin hän asettaisi paussin</a>. Najko ehdotti, että vaihtaisin <code>httr</code>:n tilalle kirjaston <a href="https://httr2.r-lib.org/">httr2</a>. Tutustumisen paikka. Samoin se, miten vaihtaa <code>plyr::llply</code> modernimpaan <code>purrr::map*</code>-funktioperheeseen, jotta toisteisuus omassa koodissani vähenisi.</p>
<p>Mitä Finto AI ehdotti? Sen näkee twiittikohtaisesti tästä tekemästäni <a href="https://ttso.shinyapps.io/minatutkintweets/">apurista</a>. Valitse ensin päivä ja tunti, ja lopuksi yksi tuon tunnin aikana postitetuista twiiteistä. Kokeile myös vaihtaa palautettavien asiasanojen lukumäärää - ja klikkaa Hae!-nappia. Tulos palautuu muutamassa sekunnissa. Tässä omassa harjoitelmassani käytin kolmea asiasanaa, eikä kynnysarvoa ollut. Finto AI tarjoaa minkä tahansa omavalintaisen tekstin asiasanoitukselle <a href="https://ai.finto.fi/">tämän sivun</a>.</p>
<p>Asiasanoituksen koodi on tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/finto_ai_keywording.R">finto_ai_keywording.R</a> ja interaktiivisen <a href="https://github.com/rstudio/shiny">Shiny</a>-sovelluksen tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/app.R">app.R</a></p>
</div>
<div id="ryhmittely" class="section level3">
<h3>Ryhmittely</h3>
<p>Idea tähän koko harjoitukseen tuli Helsingin yliopiston Ekosysteemit ja ympäristö -tutkimusohjelman professori Sakari Kuikalta. Hän <a href="https://twitter.com/Sakari_Kuikka/status/1435905714455814148">ehdotti</a> puolileikillään (näin ymmärsin), että twiittien perusteella katsottaisiin</p>
<blockquote>
<p>mitkä tieteen alat tulivat esiin, paljonko ne saivat kannatusta ja kuinka suuri niiden rahoitusosuus Suomessa on?</p>
</blockquote>
<p>Miten erottaa twiittien vapaasta kielenkäytöstä tieteenala? Vaikeasti. Ilman luonnollisen kielen käsittelyn menetelmiä erotuskyky on enintään “sinne päin”. Seuraavalla #minätutkin-kierroksella tutkijoiden tulee käyttää twiiteissään Tilastokeskuksen tieteenalaluokitusta!</p>
<p>Vakavasti puhuen oma tavoitteeni oli saada aikaan visualisointi siitä, mistä aiheista suunnilleen twiitattiin ja mitkä niiden suhteet olivat päivittäin. Pelkkien asiasanojen käyttö ei tuntunut järkevältä. Niitä tulee liikaa. Olisin voinut pysyä tiukasti yhden asiasanan politiikassa per twiitti, jolloin kirjo olisi ollut pienempi, mutta siinä olisi luultavasti menetetty iso osa twiittien asiasisällöstä. Sitä paitsi ensimmäinen asiasana voi olla täydellinen huti.</p>
<p>Finto-palvelu yllättää monipuolisuudellaan. En ihan heti ymmärtänyt, mitä kaikkea onkaan tarjolla. Tartuin ensimmäiseen löydökseen ja hain asiasanoille yhtä tasoa yleisemmän termin (broader term). Niitä parsiessa kävin vielä kerran läpi vaihtoehtoja ja kas, <a href="https://api.finto.fi/">Finto API:n</a> sanastokohtaisista metodeista löytyi <a href="https://api.finto.fi/doc/#!/Vocabulary45specific32methods/get_vocid_data">get_vocid_data</a>, joka palauttaa mm. asiasanan <a href="https://finto.fi/yso/fi/groups">käsiteryhmän</a>, yhden tai useamman. Ryhmiäkin on paljon, mutta oleellisesti vähemmän kuin erilaisia asiasanoja.</p>
<p>Tämän osuuden koodi on tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/finto_ontology.R">finto_ontology.R</a>.</p>
</div>
<div id="visualisointi" class="section level3">
<h3>Visualisointi</h3>
<p>Olen seurannut R-ekosysteemin <a href="https://github.com/rfordatascience/tidytuesday">#tidytuesday</a>-tapahtumaa. Viikolla 37 julkaistu datasetti käsitteli USA:n <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-09-14/readme.md">Billboard Top 100</a> -listaa. Sen visualisoinneista huomio kiinnittyi Georgios Karamanisin näyttävään <a href="https://github.com/gkaramanis/tidytuesday/tree/master/2021/2021-week37">toteutukseen</a>, jossa vaaka-akselilla on vuosi ja pystyakselilla jaettu pylväsgraafi musiikkityylien suhteellisista osuuksista kunakin vuonna. Otin hänen <code>ggplot2</code>-koodistaan mallia.</p>
<p>Karamanisilla musiikkityylit ovat nimen mukaisessa aakkosjärjestyksessä, suuruuserot käyvät ilmi kirjasimen koosta. #minätutkin-esitykseen halusin sen sijaan käsiteryhmät koon mukaisessa järjestyksessä, mielellään niin että samalla ryhmällä on aina sama väri. Ollaan faktoreiden (factor) järjestelyn alueella. Lopputuloksessa on parantamisen varaa, sillä löytämäni <a href="https://stackoverflow.com/a/53598064">keino tehdä tämä</a> rikkoo ryhmävärityksen, kun ryhmiä on enemmän kuin 35. Näin ollen rajasin niiden lukumäärää niin, että jätin pois harvemmin esiintyneet.</p>
<p><img src="/images/minatutkintweets.png" alt="minatutkintweets" />
<em>#minätutkin-twiittien aiheet 6-12.9.2021</em></p>
<p>Visualisoinnin koodi on tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/viz.R">viz.R</a> ja visualisoinnin kohteena ollut data tiedostossa <a href="https://github.com/tts/minatutkintweets/blob/main/day_group_n.csv">day_group_n.csv</a>.</p>
</div>
<div id="lopuksi" class="section level3">
<h3>Lopuksi</h3>
<p>Finto AI ei suinkaan asiasanoita virheettä eikä sen ole nykymuodossa tarkoituskaan, se <strong>ehdottaa</strong>. Päätelmien tekemisten kanssa on siis oltava varovainen. Joitakin havaintoja voi silti tehdä.</p>
<p>Suhteelliset erot ovat pieniä yleisimpien käsiteryhmien välillä. Kiinnostavasti <em>klimatologia</em> on ensimmäisen päivän neljän suuren pioneeriryhmän joukossa, mutta jää sen jälkeen sivuun. <em>Historia</em> taas on tasaisesti edustettuna kaikkina päivinä. <a href="https://finto.fi/ykl/fi/page/31.5">Väestötiede</a> sisältää asiasanoja, jotka liittyvät perhepolitiikkaan, aluesuunnitteluun, maahanmuuttoon ja siirtolaisuuteen.</p>
<p>Finto AI on lupaava ehdotuspalvelu, jolle toivoo menestystä jatkossakin, ja pitkää ikää. Tarkkuus varmasti lisääntyy ajan myötä.</p>
</div>

---
title: "Asuntohintojen alueellinen kehitys selviää todennäköisyysohjelmoinnilla"
date: 2015-05-07
language: fi
author: Janne Sinkkonen
categories:
  - news
tags:
  - news
  - R
  - stan
output:
  html_document:
    mathjax: "default"
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<div id="mitä-teimme" class="section level2">
<h2>Mitä teimme?</h2>
<p>Mallinsimme osakeasuntojen hintoja ja niiden muutoksia, postinumerotasolla, koko Suomessa, vuosina 2005–2014, perustuen Tilastokeskuksen jakamiin kauppa- ja asukasmäärätietoihin. Mallin arvioita hinnoista voi tarkastella <a href="http://kannattaakokauppa.fi/">vuorovaikutteisesta karttavisualisoinnista</a>. Tuloksista voi lukea lisää <a href="http://reaktor.com/blog/asuntojen-trendit-ja-miten-niista-tehdaan-luotettavia-ennusteita">Reaktorin blogista</a>. Työn takana on Reaktorin <a href="http://reaktor.com/datascience">Data Science -tiimi</a>. Mallinnuksen lähdekoodi löytyy <a href="https://github.com/reaktor/Neliohinnat">GitHubista</a>.</p>
</div>
<div id="mallinsimme" class="section level2">
<h2>Mallinsimme?</h2>
<p>Tilastokeskuksen avaamat asuntojen hintatiedot ovat keskiarvoja per postinumero ja vuosi. Jos kauppoja on alle kuusi, keskiarvokin on sensuroitu. Hinnan ohella ilmoitetaan kauppojen määrä.</p>
<p>Raakadatasta on useimmille postinumeroille vaikea suoraan arvioida hintoja ja etenkin niiden muutoksia.</p>
<p>Alla on vasemmalla satunnaisten postinumeroiden vuosittaisia kauppamääriä. Sensuroidut tiedot on merkitty punaisella. Oikealla postinumero-vuosi-yhdistelmät on järjestetty kauppojen määrän mukaan. Kauppoja ei ole tehty tai tieto on sensuroitu siis n. 17,5% tapauksista, ja noin puolet keskihinnoista joko puuttuu tai on laskettu alle 30 kaupan perusteella.</p>
<div class="figure">
<img src="/post/2015-06-11-apartment-prices.fi_files/harvuus.png" alt="" />
<p class="caption">Data on harvaa</p>
</div>
<p>Puuttuva tieto on puuttuvaa, mutta edes 6–30 kaupan keskiarvo <em>ei kuvaa luotettavasti alueen kaikkien osakkeiden hintatasoa</em>. Myydyt asunnot ovat satunnaisesti keskihintaa kalliimpia ja halvempia. Vielä huonompaa jälkeä syntyy, kun näin vähistä kaupoista yritetään suoraan arvioida hintojen muutoksia. <strong>Mediassa julkaistut listat parhaiten ja huonoiten menestyvistä alueista ovatkin lähes satunnaisia</strong>, tiheimpiä taajamia lukuunottamatta.</p>
<p>Hinnoista saa paremman kuvan, kun aineistoon sovittaa tilastollisen mallin. Tai jos ei saa, malli paljastaa lähtötietojen heikkouden — hyvin tehdystä mallista saa epävarmuusarviot kiinnostaville asioille, kuten hintatasoille.</p>
<p>Malli voi myös ottaa huomioon alueellisen jatkuvuuden, ts. lähekkäisten postinumeroalueiden samankaltaisuuden. Se osaa painottaa trendi- ja keskihinta-arvioissa kauppojen määrän oikein, ja vielä paikata jäljelle jäävää epävarmuutta postinumeroalueen muilla ominaisuuksilla, kuten väestötiheydellä.</p>
<p>Alla vasemmalla on kartta postinumeroiden keskihinnoista tarkastelujaksolla 2005–2014, logaritmisena huippuhintojen hajonnan vuoksi, oikeassa kuvassa samat logaritmiset hinnat mallista. Vasemman kartan valkoisille alueille ei keskihintaa saatu, koska kauppoja ei ollut lainkaan.</p>
<div class="figure">
<img src="/post/2015-06-11-apartment-prices.fi_files/raw-vs-model.png" alt="" />
<p class="caption">Raakadataa ja mallin hintoja Espoosta</p>
</div>
<p>Vielä alla näemme kuvan eräistä Espoon postinumeroalueista. Pisteet kuvaavat Tilastokeskuksen ilmoittamia vuosihintoja, pisteiden koko kauppojen määrää. Viivat ovat mallin arvioita hintatasosta, harmaat alueet arvion epävarmuuksia, mallin itsensä mielestä.</p>
<div class="figure">
<img src="/post/2015-06-11-apartment-prices.fi_files/espoota.png" alt="" />
<p class="caption">Raakadataa ja mallin hintoja Espoosta</p>
</div>
<p>Hinta-arvioita on saatu vähistäkin kaupoista, ja etenkin vuosimuutokset ovat luotettavamman näköisiä kuin mitä melko paljon heittelevistä keskihinnoista suoraan laskien saisi. Hintojen mallintaminen siis kannattaa.</p>
<p>Mallista saa ennusteen lähivuosille, mutta ennusteen kanssa kannattaa olla varovainen. Talouden kehitystä ja muita hintoihin ratkaisevasti vaikuttavia seikkoja on mahdoton ennustaa tarkasti muutamaa kuukautta pidemmälle. <em>Malli on parhaimmillaan kuvattaessa lähimenneisyyden hintakehityksen pääpiirteitä, ei ennustettaessa tulevaisuutta.</em></p>
<p>Alla on yksityiskohtaisempaa tietoa datasta, mallista ja visualisoinnista.</p>
</div>
<div id="ympäristö" class="section level2">
<h2>Ympäristö</h2>
<p>Mallinnus tehtiin <a href="http://www.r-project.org">R-ympäristössä</a>, itse malli <a href="http://mc-stan.org">Stan-kirjastolla</a>, ja kaikki lähdekoodi on saatavilla <a href="https://github.com/reaktor/Neliohinnat">GitHubista</a>.</p>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p><a href="http://www.stat.fi/til/ashi/index.html">Asuntojen hintatiedot</a> saa Tilastokeskukselta kätevästi R:ään <a href="http://louhos.github.io/">Louhos</a>- ja <a href="http://ropengov.github.io/">Ropengov</a>-projektien kirjastoilla <a href="http://cran.r-project.org/web/packages/pxweb/index.html">pxweb</a> (hinnat) ja <a href="https://github.com/ropengov/gisfin">gisfin</a> (muut). Postinumeroalueiden karttapohja haettiin <a href="http://www.palomaki.info/apps/pnro/">Duukkikselta</a>. Skriptit datojen hakemiseen, käsittelyyn ja yhdistelyyn ovat <a href="https://github.com/reaktor/Neliohinnat">GitHub-repossa</a>.</p>
</div>
<div id="karttavisualisointi" class="section level2">
<h2>Karttavisualisointi</h2>
<p>Karttapohjia postinumeroalueittaiselle aineistolle saa ainakin Tilastokeskuksen <a href="http://www.stat.fi/tup/rajapintapalvelut/paavo.html">Paavo-rajapinnasta</a> ja <a href="http://www.palomaki.info/apps/pnro/">Duukkikselta</a>. Paavo tarjoaa kartasta kahta versiota. Merialueet sisältävä kartta ei sovi visualisointiin ilman erillistä rantaviivaa. Rantaviivaan rajattu näytti hyvältä, mutta tarkkuudesta maksettaisiin GeoJSON-objektin koolla: yli 20 megatavua. Päädyimme käyttämään Duukkiksen pohjaa, jossa karkea rantaviiva tuottaa meille hyvän kompromissin koon ja ulkonäön välillä.</p>
<p>Pieniä eroja postinumeroissa oli, joten muutama alue on saattanut karttapohjan valinnan takia kadota.</p>
<p>Malli tuottaa hinta-arvioita vaikkei postinumerossa olisi osakehuoneistoja, kaupoista puhumattakaan: pelkkä sijainti ja väestötiheys riittävät. Muutamilta pieniltä, teollisuus- ja sairaala-alueiden näköisiltä postinumeroilta puuttuu väestötietokin, ehkä koska niissä ei virallisesti asu ketään. Nämä pienet postinumeroalueet näkyvät kartassa harmaana ja ilman ennustetta.</p>
</div>
<div id="malli" class="section level2">
<h2>Malli</h2>
<p>Mallin asuntojen hinnoista pitää ottaa huomioon monta asiaa. Tärkein on tietenkin <em>toteutuneiden kauppojen hinnat</em> — joista tiedämme vain keskiarvon jos sitäkään. Tiedossa oleva kauppojen lukumäärä auttaa, koska keskihinta kertoo tarkemmin hintatasosta kun kauppoja on enemmän.</p>
<p>Koska kauppatietoa on etenkin maalta vähän, on hyvä ottaa malliin <em>postinumeroiden ominaisuuksia</em>, jotka selittävät hintavaihtelua. Taajamissa asunnot ovat kalliimpia, joten asumistiheys on ilmeisen tärkeää. Postinumeroittainen asukastiheys ei ole sama asia kuin keskimääräinen asumistiheys, mutta korreloi siihen vahvasti.</p>
<p>Hintojen alueellinen vaihtelu tekee lähekkäisistä postinumeroista keskimäärin samankaltaisia. Tätä voi hyödyntää hinta-arvioissa: naapuripostinumeron kaupat kertovat ainakin karkealla tasolla omastakin alueesta, etenkin jos oman alueen kauppoja on vähän. Tietenkään emme voi tehdä riippuvuudesta vahvaa oletusta, mutta voimme antaa mallin havaita riippuvuuden ja käyttää sitä, jos riippuvuutta on.</p>
<p>Päädyimme mallissa koodaamaan alueiden lähekkäisyyden hierarkiaksi, joka saadaan suoraan numerosta: Esim. 02940 on Uusimaata (0), Espoota (02) ja Pohjois-Espoota (029). Hierarkia antaa mahdollisuuden mallille pitää näiden ja muiden vastaavien sisäkkäisten alueiden postinumeroita samanlaisina ympäristöön verrattuna, jos ne sitä ovat. (Spatiaalinen lähekkäisyys olisi vaihtoehto, mutta se on monella tapaa teknisesti hankalampi ja kadottaa mahdollisen äititaajaman vaikutuksen.)</p>
<p>Hinnoissa kiinnostavinta on tason jälkeen ajallinen muutos. Niinpä hintatason ja vuoden keskinäinen suhde mallissa on oleellinen sen luonteen ja informatiivisuuden kannalta. Vuosille voisi kullekin antaa omat hintatasonsa, mutta hintatason ajallinen muutos olisi vapaiden vuositasojen mallissa liiankin vapaasti määritelty, eikä ennustetta ensi vuodelle syntyisi. Ja koska hintatason muutokset ovat hintojen tapaan alueellisia ja voivat riippua esim. väestötiheydestä, päädyimme malliin, jossa hinnan ajallinen muutos eli trendi ja trendin muutos ovat eksplisiittisesti mukana.</p>
<p>Vuoden vaikutus mallissa on siis kvadraattinen, ts. joka postinumerolla on mallissa oma trendinsä ja trendin muutosnopeus per vuosi. Lisäksi väestötiheys pääsee ennustamaan näitä muutoksia. Sen vaikutus näkyy etenkin jos kauppoja on vain vähän tai ei ollenkaan.</p>
<p>Postinumerokohtaisia hintaparametreja kertyy yhteensä kuusi: hintataso, trendi, trendin muutos, ja väestötiheyden vaikutus näihin kaikkiin. Parametreilla on arvot ja varianssit myös postinumeroa isommille hierarkian alueille (Uusimaa, Espoo, jne.), josta ne pääsevät vaikuttamaan postinumerokohtaisiin arvioihin etenkin kun kauppoja on vähän. Parametreilla on myös eri hierarkiatasoilla kovarianssit, jolloin ne voivat auttaa toistensa estimointia tapauksissa joissa hintadata ei suoraan riitä.</p>
<p>Yhteenvetona kaavaksi, mallin alataso havaitulle keskihinnalle <span class="math display">\[y\]</span> on</p>
<p><span class="math display">\[
\log h_{it} = 
       \beta_{i1} + \beta_{i2} t + \beta_{i3} t^2 + \beta_{i’4}d_i + \beta_{i’5}d_i\,t + \beta_{i’6}d_i\,t^2, 
\]</span></p>
<p><span class="math display">\[
\log y_{it} \sim 
\textrm{t}\,\left(\log h_{it}, \, \sqrt{\sigma^2_y + \frac{\sigma^2_w}{n_{it}}}, \, \nu\right)\,,
\]</span></p>
<p>jossa <span class="math display">\[i\]</span> on postinumeroalue, <span class="math display">\[t\]</span> vuosi, <span class="math display">\[\beta\]</span> ovat postinumerokohtaisia hintakertoimia, <span class="math display">\[i’\]</span> on postinumeron alin hierarkiataso (väestötiheysparametrit ovat yhteisiä kullekin <span class="math display">\[i’\]</span>-alueelle), <span class="math display">\[t()\]</span> on t-jakauma, <span class="math display">\[\sigma_y\]</span> vuosikohtainen hajonta, <span class="math display">\[\sigma_w\]</span> kauppahintojen hajonta mittausyksikön (vuosi<span class="math display">\[\times\]</span>postinumero) sisällä, ja <span class="math display">\[\nu\]</span> t-jakautuneen residuaalin vapausaste. Hinnat käsitellään mallissa logaritmisena, jolloin absoluuttisella hintaskaalalla malli on multiplikatiivinen. Hajonnat ja <span class="math display">\[\nu\]</span> estimoidaan kaiken muun ohella. Kertoimille <span class="math display">\[\beta\]</span> on multinormaali priori kovarianssimatriiseineen, ja lisäksi ylemmille hierarkiatasoille eli postinumeroa suuremmille alueille omat vastaavat rakenteensa (<span class="math display">\[\beta\]</span> ja sen priorit). Yksityiskohdat tätä tarkemmin selviävät parhaiten <a href="https://github.com/reaktor/Neliohinnat/blob/master/source/m4.stan">mallikoodista</a>.</p>
<p>Vapausasteen <span class="math display">\[\nu\]</span> estimaatti on luokkaa 6,5, eli hintojen residuaali on normaalijakaumaa selvästi pitkähäntäisempi. Suoraan mallin parametreista (koodissa matriisi “Omega”) nähdään, että hintataso ja trendi korreloivat yli postinumeroalueiden (<span class="math display">\[r\]</span>=0,28), samoin trendin muutos ja hintataso (<span class="math display">\[r\]</span>=0,43). Halvat alueet ovat siis viimeisen n. kymmenen vuoden aikana halventuneet edelleen, ja kalliit kallistuneet. Tämä liittynee asutuksen keskittymiseen.</p>
<p>Postinumerokohtaisista estimaateista nähdään, että asukastiheys korreloi niin hintatasoon kuin sen muutoksiinkin:</p>
<div class="figure">
<img src="/post/2015-06-11-apartment-prices.fi_files/tiheys-korrelaatiot.png" alt="" />
<p class="caption">Asukastiheyden ja hinnan korrelaatiot</p>
</div>
<p>Malli on estimoitu Stan-kirjastolla (<a href="http://mc-stan.org/">http://mc-stan.org/</a>). Stan on <a href="https://louhos.wordpress.com/2014/01/29/stan-kj/">todennäköisyysohjelmointikieli</a>, joka tuottaa generatiivisesta mallin kuvauksesta estimointialgoritmin. Vaihtoehdoista estimoinnin itse koodaaminen olisi huomattavan työlästä, kun taas valmiiden mallipakettien (lme4, mgcv, …) käyttäminen pakottaisi tyytymään rajoittuneempaan malliin, joka kuvaisi asuntojen hintoja ja niiden vaihtelua huonommin.</p>
</div>
